<?xml version="1.0" encoding="UTF-8"?>
<project name="multibit-0.5.14" default="make-dmg">
    <property name="build.dir" value="."/>

    <property file="ant-mac-build.properties"/>

    <target name="make-dmg"  xmlns:fx="javafx:com.sun.javafx.tools.ant">
        <taskdef resource="com/sun/javafx/tools/ant/antlib.xml" uri="javafx:com.sun.javafx.tools.ant" classpath=".:package/windows:${jdk.home.1.7}/lib/ant-javafx.jar"/>

        <!-- Mark application as Swing-based --> 
        <fx:application id="multibitApp" mainClass="org.multibit.MultiBitInExecutableJar" toolkit="swing" name="MultiBit-${multibit-version}" version=""/>

        <!-- Create executable jar file -->
        <fx:jar destfile="target/windows/multibit-mac-exe.jar">
            <fileset dir="target/windows/multibit-exe.dir"/>
            <fx:application refid="multibitApp"/>
            <manifest> 
                <attribute name="Implementation-Vendor" value="multibit.org developers"/>
                <attribute name="Implementation-Title" value="multibit-${multibit-version}"/>
                <attribute name="Implementation-Version" value="${multibit-version}"/>
            </manifest> 
        </fx:jar>

        <!-- generate JNLPs, HTML and native bundles --> 
        <fx:deploy width="960" height="720" includeDT="true" 
                  nativeBundles="all" 
                  outdir="target-mac" embedJNLP="true" verbose="true"
                  outfile="MultiBit-${multibit-version}">
            <fx:application refId="multibitApp"/>
            <fx:resources> 
                <fx:fileset dir="target/windows" includes="multibit-mac-exe.jar"/>
                <fx:fileset dir="target/windows/staging" includes="**/*.*"/>
                <fx:fileset dir="${jdk.home.1.7}\\jre\\lib\\ext" includes="*.*"/>
                <fx:fileset dir="${jdk.home.1.7}\\jre\\lib\\ext" includes="*"/>
                <fx:fileset dir="${jdk.home.1.7}\\jre\\bin" includes="javaw.exe"/>
                <fx:fileset dir="package/windows" includes="license.rtf" type="license"/>
            </fx:resources>
            <fx:permissions/>
        </fx:deploy>

        <!-- The installer file is called, say, MultiBit-0.5.14-.exe (note the trailing dash) but for compatibility
             with the older installer name and to get automatic rights elevation, rename it to, say, multibit-0.5.14-windows-setup.exe -->
        <move file="target-win/bundles/MultiBit-${multibit-version}-.exe" tofile="target-win/bundles/multibit-${multibit-version}-windows-setup.exe"/>
    </target>
</project>
